version: "3.8"

services:
  cms-db:
    image: mysql:8.0
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: 812345
      MYSQL_DATABASE: xibo
      MYSQL_USER: xibo
      MYSQL_PASSWORD: 812345
    volumes:
      - db_data:/var/lib/mysql
    ports:
      - "3306:3306"

  cms-web:
    image: ghcr.io/xibosignage/xibo-cms:release-4.3.1
    restart: unless-stopped
    environment:
      MYSQL_HOST: cms-db
      MYSQL_DATABASE: xibo
      MYSQL_USER: xibo
      MYSQL_PASSWORD: 812345
      CMS_SERVER_NAME: localhost
      TZ: Europe/Berlin
    ports:
      - "8082:80"
    depends_on:
      - cms-db

  cms-xmr:
    image: ghcr.io/xibosignage/xibo-xmr:1.0
    restart: unless-stopped
    ports:
      - "9505:9505"

  cms-memcached:
    image: memcached:alpine
    restart: unless-stopped

  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    restart: unless-stopped
    environment:
      PMA_HOST: cms-db
      PMA_PORT: 3306
      PMA_USER: xibo
      PMA_PASSWORD: 812345
    ports:
      - "8081:80"
    depends_on:
      - cms-db

  xibo-puppeteer-bridge:
    build: .
    container_name: xibo-puppeteer-bridge
    restart: unless-stopped
    environment:
      NOVENTA_USER: "MMCS-SPU-Leitstand"
      NOVENTA_PASS: "SPU-LEITSTAND"
      LOGIN_URL: "https://mpa.noventa-consulting.com/cockpit#/login"
      DASHBOARD_URL: "https://mpa.noventa-consulting.com/cockpit/"
      COOKIE_FILE: "/data/cookies.json"
      HEADLESS: "true"
      PORT: 3000
    volumes:
      - bridge_data:/data
    ports:
      - "3000:3000"

volumes:
  db_data:
  bridge_data: